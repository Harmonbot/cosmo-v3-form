<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COSMO V3 è¯Šæ–­ â€” æ•°æ®é‡‡é›†</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Password gate */
#pwGate {
  position: fixed; inset: 0; z-index: 99999;
  background: #08090c;
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Sans', 'Noto Sans SC', sans-serif;
}
#pwGate.hidden { display: none; }
.pw-box {
  text-align: center; padding: 48px 40px; background: #13151c;
  border: 1px solid #1c2030; border-radius: 16px; width: 360px;
}
.pw-box h2 { color: #e8eaf2; font-size: 20px; margin: 0 0 6px; }
.pw-box p { color: #565b72; font-size: 13px; margin: 0 0 24px; }
.pw-box input {
  width: 100%; padding: 12px 16px; background: #0d0f14; border: 1px solid #1c2030;
  border-radius: 10px; color: #e8eaf2; font-size: 15px; text-align: center;
  letter-spacing: 3px; outline: none; box-sizing: border-box;
}
.pw-box input:focus { border-color: #f59e0b; box-shadow: 0 0 0 3px rgba(245,158,11,0.08); }
.pw-box button {
  margin-top: 16px; width: 100%; padding: 12px; background: #f59e0b; color: #000;
  font-weight: 700; border: none; border-radius: 10px; cursor: pointer; font-size: 14px;
}
.pw-box button:hover { background: #fbbf24; }
.pw-err { color: #ef4444; font-size: 12px; margin-top: 10px; display: none; }
</style>
<script>
// ===== PASSWORD CONFIG =====
// Change this password before deploying
const ACCESS_CODE = 'cosmo2026';
// ===========================

function checkPw() {
  const input = document.getElementById('pwInput');
  if (input.value === ACCESS_CODE) {
    document.getElementById('pwGate').classList.add('hidden');
    sessionStorage.setItem('cosmo_auth', '1');
  } else {
    document.getElementById('pwErr').style.display = 'block';
    input.value = '';
    input.focus();
  }
}
document.addEventListener('DOMContentLoaded', () => {
  if (sessionStorage.getItem('cosmo_auth') === '1') {
    document.getElementById('pwGate').classList.add('hidden');
  } else {
    document.getElementById('pwInput')?.focus();
    document.getElementById('pwInput')?.addEventListener('keydown', e => {
      if (e.key === 'Enter') checkPw();
    });
  }
});
</script>
<style>
:root {
  --bg: #08090c;
  --bg-surface: #0f1116;
  --bg-card: #13151c;
  --bg-elevated: #191c26;
  --bg-input: #0d0f14;
  --border: #1c2030;
  --border-focus: #f59e0b;
  --border-hover: #2a3050;
  --text: #e8eaf2;
  --text-secondary: #9498ae;
  --text-muted: #565b72;
  --text-placeholder: #3d4258;
  --accent: #f59e0b;
  --accent-hover: #fbbf24;
  --accent-glow: rgba(245,158,11,0.08);
  --accent-glow-strong: rgba(245,158,11,0.15);
  --green: #22c55e;
  --green-dim: rgba(34,197,94,0.1);
  --red: #ef4444;
  --red-dim: rgba(239,68,68,0.1);
  --blue: #3b82f6;
  --blue-dim: rgba(59,130,246,0.1);
  --purple: #a855f7;
  --purple-dim: rgba(168,85,247,0.1);
  --cyan: #06b6d4;
  --cyan-dim: rgba(6,182,212,0.1);
  --orange: #f97316;
  --orange-dim: rgba(249,115,22,0.1);
  --radius: 14px;
  --radius-sm: 10px;
  --radius-xs: 6px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.35);
  --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', 'Noto Sans SC', sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  min-height: 100vh;
}

.mono { font-family: 'JetBrains Mono', monospace; }

/* ===== LAYOUT ===== */
.app {
  display: grid;
  grid-template-columns: 280px 1fr;
  min-height: 100vh;
}

@media (max-width: 900px) {
  .app { grid-template-columns: 1fr; }
  .sidebar { display: none; }
}

/* ===== SIDEBAR ===== */
.sidebar {
  background: var(--bg-surface);
  border-right: 1px solid var(--border);
  padding: 32px 0;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  scrollbar-width: none;
}

.sidebar-logo {
  padding: 0 24px;
  margin-bottom: 36px;
}

.sidebar-logo h1 {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

.sidebar-logo .version {
  font-size: 11px;
  color: var(--accent);
  font-weight: 600;
  background: var(--accent-glow);
  padding: 2px 8px;
  border-radius: 4px;
  margin-left: 8px;
}

.sidebar-logo p {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 4px;
}

/* Progress */
.sidebar-progress {
  padding: 0 24px;
  margin-bottom: 32px;
}

.progress-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.progress-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.progress-count {
  font-size: 13px;
  font-weight: 700;
  color: var(--accent);
}

.progress-bar {
  height: 6px;
  background: rgba(255,255,255,0.04);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-hover));
  border-radius: 3px;
  transition: width 0.5s ease;
}

.mode-badges {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.mode-badge {
  font-size: 11px;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 5px;
  border: 1px solid;
  transition: all var(--transition);
}

.mode-badge.ready {
  background: var(--green-dim);
  color: var(--green);
  border-color: rgba(34,197,94,0.25);
}

.mode-badge.not-ready {
  background: rgba(255,255,255,0.02);
  color: var(--text-muted);
  border-color: var(--border);
}

/* Sidebar nav */
.sidebar-nav {
  padding: 0 12px;
}

.nav-section-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  padding: 20px 12px 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition);
  margin-bottom: 2px;
  position: relative;
}

.nav-item:hover { background: rgba(255,255,255,0.03); }

.nav-item.active {
  background: var(--accent-glow);
}

.nav-item.active .nav-text { color: var(--text); font-weight: 600; }

.nav-icon {
  font-size: 16px;
  width: 24px;
  text-align: center;
  flex-shrink: 0;
}

.nav-text {
  font-size: 13px;
  color: var(--text-secondary);
  flex: 1;
}

.nav-status {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.nav-status.complete { background: var(--green); box-shadow: 0 0 6px rgba(34,197,94,0.4); }
.nav-status.partial { background: var(--orange); }
.nav-status.empty { background: var(--border); }

/* Validation */
.field-error { border-color: var(--red) !important; animation: shake 0.4s ease; }
.field-error-msg { color: var(--red); font-size: 11px; margin-top: 4px; display: block; }
@keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 75%{transform:translateX(4px);} }
.submit-toast {
  position: fixed; top: 24px; right: 24px; padding: 14px 24px; border-radius: 12px;
  font-size: 14px; font-weight: 600; z-index: 9999; animation: slideIn 0.3s ease;
  box-shadow: 0 8px 30px rgba(0,0,0,0.4);
}
.submit-toast.success { background: var(--green); color: #000; }
.submit-toast.error { background: var(--red); color: #fff; }
@keyframes slideIn { from{opacity:0;transform:translateY(-20px);} to{opacity:1;transform:translateY(0);} }

/* ===== MAIN CONTENT ===== */
.main {
  padding: 40px;
  max-width: 920px;
}

@media (max-width: 900px) {
  .main { padding: 24px 16px; }
}

/* Page header */
.page-header {
  margin-bottom: 36px;
}

.page-header h2 {
  font-size: 26px;
  font-weight: 700;
  letter-spacing: -0.5px;
  margin-bottom: 6px;
}

.page-header p {
  font-size: 14px;
  color: var(--text-secondary);
}

/* ===== MODE SELECTOR ===== */
.mode-selector {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 40px;
}

.mode-option {
  position: relative;
  padding: 20px 24px;
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all var(--transition);
}

.mode-option:hover { border-color: var(--border-hover); }

.mode-option.selected {
  border-color: var(--accent);
  background: var(--accent-glow);
}

.mode-option.selected::after {
  content: 'âœ“';
  position: absolute;
  top: 14px;
  right: 16px;
  width: 22px;
  height: 22px;
  background: var(--accent);
  color: #000;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 700;
}

.mode-label {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 4px;
}

.mode-desc {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.5;
}

.mode-items {
  margin-top: 10px;
  font-size: 11px;
  color: var(--text-muted);
}

/* ===== FORM SECTIONS ===== */
.form-section {
  margin-bottom: 40px;
  animation: fadeUp 0.3s ease;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

.form-section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  padding-bottom: 14px;
  border-bottom: 1px solid var(--border);
}

.form-section-icon {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  font-size: 16px;
  flex-shrink: 0;
}

.form-section-title {
  font-size: 17px;
  font-weight: 700;
  letter-spacing: -0.2px;
}

.form-section-subtitle {
  font-size: 12px;
  color: var(--text-muted);
}

.form-section-tag {
  margin-left: auto;
  font-size: 10px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 4px;
  letter-spacing: 0.3px;
}

.tag-required { background: var(--red-dim); color: var(--red); }
.tag-recommended { background: var(--blue-dim); color: var(--blue); }
.tag-mode-b { background: var(--purple-dim); color: var(--purple); }

/* ===== FORM FIELDS ===== */
.field-grid {
  display: grid;
  gap: 16px;
}

.field-grid-2 { grid-template-columns: 1fr 1fr; }
.field-grid-3 { grid-template-columns: 1fr 1fr 1fr; }
.field-grid-4 { grid-template-columns: repeat(4, 1fr); }

@media (max-width: 700px) {
  .field-grid-2, .field-grid-3, .field-grid-4 { grid-template-columns: 1fr; }
}

.field {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.field-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.field-label .required {
  color: var(--red);
  font-size: 14px;
}

.field-hint {
  font-size: 11px;
  color: var(--text-muted);
  font-weight: 400;
}

.field-input {
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  padding: 10px 14px;
  font-size: 14px;
  color: var(--text);
  font-family: inherit;
  outline: none;
  transition: all var(--transition);
  width: 100%;
}

.field-input::placeholder {
  color: var(--text-placeholder);
}

.field-input:hover { border-color: var(--border-hover); }

.field-input:focus {
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.field-input.mono {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  letter-spacing: 0.5px;
}

select.field-input {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23565b72' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
}

textarea.field-input {
  resize: vertical;
  min-height: 80px;
}

/* ===== FILE UPLOAD ZONES ===== */
.upload-zone {
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  padding: 28px 24px;
  text-align: center;
  cursor: pointer;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
}

.upload-zone:hover {
  border-color: var(--border-hover);
  background: rgba(255,255,255,0.01);
}

.upload-zone.dragover {
  border-color: var(--accent);
  background: var(--accent-glow);
}

.upload-zone.has-files {
  border-style: solid;
  border-color: rgba(34,197,94,0.3);
  background: var(--green-dim);
}

.upload-icon {
  font-size: 28px;
  margin-bottom: 10px;
  opacity: 0.6;
}

.upload-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 4px;
}

.upload-desc {
  font-size: 12px;
  color: var(--text-muted);
  line-height: 1.5;
}

.upload-formats {
  margin-top: 10px;
  display: flex;
  gap: 6px;
  justify-content: center;
  flex-wrap: wrap;
}

.format-tag {
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 3px;
  background: rgba(255,255,255,0.04);
  color: var(--text-muted);
  border: 1px solid rgba(255,255,255,0.06);
}

input[type="file"] { display: none; }

/* Uploaded file list */
.file-list {
  margin-top: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.file-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: rgba(255,255,255,0.03);
  border-radius: var(--radius-xs);
  border: 1px solid var(--border);
  text-align: left;
}

.file-item-icon { font-size: 14px; }
.file-item-name { font-size: 12px; flex: 1; color: var(--text); font-weight: 500; }
.file-item-size { font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

.file-item-remove {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  color: var(--text-muted);
  transition: all var(--transition);
  background: none;
  border: none;
}

.file-item-remove:hover {
  background: var(--red-dim);
  color: var(--red);
}

/* Multi-image upload grid */
.image-upload-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

@media (max-width: 700px) {
  .image-upload-grid { grid-template-columns: repeat(2, 1fr); }
}

.image-slot {
  aspect-ratio: 1;
  border: 2px dashed var(--border);
  border-radius: var(--radius-sm);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
}

.image-slot:hover {
  border-color: var(--border-hover);
  background: rgba(255,255,255,0.015);
}

.image-slot.filled {
  border-style: solid;
  border-color: rgba(34,197,94,0.3);
  background: var(--green-dim);
}

.image-slot.filled .image-slot-icon,
.image-slot.filled .image-slot-label {
  opacity: 0;
  pointer-events: none;
}

.image-slot-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  margin-top: 6px;
}

.image-slot-icon {
  font-size: 22px;
  opacity: 0.4;
}

.image-slot-preview {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: var(--surface-1);
  border-radius: calc(var(--radius-sm) - 2px);
  padding: 4px;
}

.image-slot-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity var(--transition);
  color: white;
  font-size: 12px;
  font-weight: 600;
}

.image-slot.filled:hover .image-slot-overlay { opacity: 1; }

/* ===== AD DATA TABLE INPUT ===== */
.inline-table {
  width: 100%;
  border-collapse: collapse;
}

.inline-table th {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  padding: 8px 10px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

.inline-table td {
  padding: 4px 4px;
  border-bottom: 1px solid rgba(28,32,48,0.4);
}

.inline-table .row-label {
  font-size: 13px;
  font-weight: 500;
  padding: 10px 10px;
  color: var(--text-secondary);
  white-space: nowrap;
}

.inline-table input {
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  padding: 8px 10px;
  font-size: 13px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  outline: none;
  width: 100%;
  transition: all var(--transition);
}

.inline-table input:focus {
  border-color: var(--border-focus);
  box-shadow: 0 0 0 2px var(--accent-glow);
}

.inline-table input::placeholder { color: var(--text-placeholder); }

/* ===== TEXT INPUT CARDS ===== */
.text-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}

.text-card-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(255,255,255,0.015);
}

.text-card-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
}

.text-card-hint {
  font-size: 11px;
  color: var(--text-muted);
  margin-left: auto;
}

.text-card textarea {
  width: 100%;
  background: transparent;
  border: none;
  padding: 14px 16px;
  font-size: 13px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  outline: none;
  resize: vertical;
  min-height: 100px;
  line-height: 1.7;
}

.text-card textarea::placeholder { color: var(--text-placeholder); }

/* ===== ACTION BUTTONS ===== */
.actions-bar {
  position: sticky;
  bottom: 0;
  background: linear-gradient(to top, var(--bg) 60%, transparent);
  padding: 24px 0;
  display: flex;
  gap: 12px;
  align-items: center;
}

.btn {
  padding: 12px 28px;
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition);
  border: none;
  font-family: inherit;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--accent);
  color: #000;
}

.btn-primary:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 20px rgba(245,158,11,0.3);
}

.btn-primary:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.btn-secondary {
  background: rgba(255,255,255,0.05);
  color: var(--text-secondary);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: rgba(255,255,255,0.08);
  color: var(--text);
}

.actions-spacer { flex: 1; }

.save-hint {
  font-size: 12px;
  color: var(--text-muted);
}

/* ===== RUFUS GUIDE ===== */
.rufus-guide {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 16px;
}

.rufus-guide-header {
  padding: 14px 18px;
  background: var(--cyan-dim);
  border-bottom: 1px solid rgba(6,182,212,0.15);
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: background var(--transition);
}

.rufus-guide-header:hover { background: rgba(6,182,212,0.15); }

.rufus-guide-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--cyan);
  flex: 1;
}

.rufus-guide-toggle {
  font-size: 12px;
  color: var(--cyan);
  transition: transform var(--transition);
}

.rufus-guide-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
}

.rufus-guide.open .rufus-guide-body {
  max-height: 1200px;
}

.rufus-guide.open .rufus-guide-toggle {
  transform: rotate(180deg);
}

.rufus-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

.rufus-table th {
  padding: 8px 14px;
  text-align: left;
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  border-bottom: 1px solid var(--border);
  background: rgba(255,255,255,0.015);
}

.rufus-table td {
  padding: 8px 14px;
  border-bottom: 1px solid rgba(28,32,48,0.3);
  color: var(--text-secondary);
  line-height: 1.5;
}

.rufus-table tr:hover td { background: rgba(255,255,255,0.01); }

.rufus-q {
  color: var(--cyan);
  font-weight: 500;
  font-style: italic;
}

/* ===== COMPETITOR INPUT CARDS ===== */
.competitor-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 12px;
}

.competitor-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
}

.competitor-num {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 700;
}

.competitor-label {
  font-size: 14px;
  font-weight: 600;
}

.competitor-desc {
  font-size: 12px;
  color: var(--text-muted);
}

/* Comp Rufus inline */
.comp-rufus-inline {
  margin-top: 16px;
  padding-top: 14px;
  border-top: 1px dashed var(--border);
}

.comp-rufus-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--cyan);
  margin-bottom: 12px;
}

.comp-rufus-qa-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
}

@media (max-width: 700px) {
  .comp-rufus-qa-row { grid-template-columns: 1fr; }
}

.comp-rufus-qa {
  display: flex;
  flex-direction: column;
}

.comp-rufus-qa input {
  font-size: 12px;
}

.comp-rufus-qa textarea {
  font-size: 12px;
  min-height: 48px;
}

/* ===== DIVIDER ===== */
.divider {
  height: 1px;
  background: var(--border);
  margin: 40px 0;
}

/* ===== TOOLTIP ===== */
.tip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(255,255,255,0.06);
  font-size: 10px;
  color: var(--text-muted);
  cursor: help;
  position: relative;
}

.tip:hover::after {
  content: attr(data-tip);
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  padding: 8px 12px;
  font-size: 11px;
  color: var(--text-secondary);
  white-space: nowrap;
  z-index: 100;
  box-shadow: var(--shadow-md);
}

/* ===== HIDDEN SECTIONS (Mode B only) ===== */
.mode-b-section {
  transition: opacity 0.3s ease, max-height 0.4s ease;
}

.mode-b-section.hidden {
  opacity: 0.3;
  pointer-events: none;
  position: relative;
}

.mode-b-section.hidden::after {
  content: 'ğŸ”’ æ¨¡å¼Bä¸“å± â€” é€‰æ‹©å…¨é‡è¯Šæ–­åè§£é”';
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-muted);
  background: rgba(8,9,12,0.7);
  border-radius: var(--radius);
  z-index: 10;
}

/* ===== ALERT ===== */
.alert-info {
  padding: 12px 16px;
  background: var(--blue-dim);
  border: 1px solid rgba(59,130,246,0.2);
  border-radius: var(--radius-sm);
  font-size: 12px;
  color: var(--blue);
  line-height: 1.6;
  margin-bottom: 16px;
  display: flex;
  gap: 10px;
  align-items: flex-start;
}

.alert-info-icon { font-size: 15px; flex-shrink: 0; margin-top: 1px; }
</style>
</head>
<body>

<!-- Password Gate -->
<div id="pwGate">
  <div class="pw-box">
    <h2>ğŸ” COSMO V3</h2>
    <p>è¯·è¾“å…¥è®¿é—®å¯†ç </p>
    <input type="password" id="pwInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off">
    <button onclick="checkPw()">è¿›å…¥ç³»ç»Ÿ</button>
    <div class="pw-err" id="pwErr">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
  </div>
</div>

<div class="app">
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <h1>COSMO <span class="version">V3</span></h1>
      <p>Amazon Listingè¯Šæ–­ç³»ç»Ÿ</p>
    </div>

    <!-- Progress -->
    <div class="sidebar-progress">
      <div class="progress-header">
        <span class="progress-label">æ•°æ®é‡‡é›†è¿›åº¦</span>
        <span class="progress-count" id="progressCount">0 / 7</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="mode-badges">
        <div class="mode-badge not-ready" id="modeABadge">æ¨¡å¼A æœªå°±ç»ª</div>
        <div class="mode-badge not-ready" id="modeBBadge">æ¨¡å¼B æœªå°±ç»ª</div>
      </div>
    </div>

    <!-- Nav -->
    <nav class="sidebar-nav">
      <div class="nav-section-label">åŸºç¡€è¾“å…¥</div>
      <div class="nav-item active" onclick="navScrollTo('sec-mode')">
        <span class="nav-icon">âš¡</span>
        <span class="nav-text">è¯Šæ–­æ¨¡å¼</span>
        <span class="nav-status complete"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-basic')">
        <span class="nav-icon">ğŸ“</span>
        <span class="nav-text">äº§å“åŸºç¡€ä¿¡æ¯</span>
        <span class="nav-status empty" id="navBasic"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-competitors')">
        <span class="nav-icon">âš”ï¸</span>
        <span class="nav-text">ç«å“ä¿¡æ¯</span>
        <span class="nav-status empty" id="navCompetitors"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-supplement')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">è¡¥å……è¿è¥æ•°æ®</span>
        <span class="nav-status empty" id="navSupplement"></span>
      </div>

      <div class="nav-section-label">Seller Central æŠ¥å‘Š</div>
      <div class="nav-item" onclick="navScrollTo('sec-ad-reports')">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-text">å¹¿å‘ŠæŠ¥å‘Š (5ä»½)</span>
        <span class="nav-status empty" id="navAdReports"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-biz-reports')">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text">ä¸šåŠ¡+é€€è´§+å“ç‰Œåˆ†æ</span>
        <span class="nav-status empty" id="navBizReports"></span>
      </div>

      <div class="nav-section-label">Listing ç´ æ</div>
      <div class="nav-item" onclick="navScrollTo('sec-images')">
        <span class="nav-icon">ğŸ–¼ï¸</span>
        <span class="nav-text">ä¸»å›¾ (7å¼ +è§†é¢‘)</span>
        <span class="nav-status empty" id="navImages"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-aplus')">
        <span class="nav-icon">âœ¨</span>
        <span class="nav-text">A+å†…å®¹æˆªå›¾</span>
        <span class="nav-status empty" id="navAplus"></span>
      </div>
      <div class="nav-item" onclick="navScrollTo('sec-listing-text')">
        <span class="nav-icon">ğŸ“„</span>
        <span class="nav-text">æ ‡é¢˜/Bullet/Search Terms</span>
        <span class="nav-status empty" id="navListingText"></span>
      </div>

      <div class="nav-section-label">Rufus æˆªå›¾</div>
      <div class="nav-item" onclick="navScrollTo('sec-rufus')">
        <span class="nav-icon">ğŸ¤–</span>
        <span class="nav-text">Rufusé—®ç­” (è‡ªèº«20é¢˜)</span>
        <span class="nav-status empty" id="navRufus"></span>
      </div>

      <div class="nav-section-label">æ‰‹å·¥æ•°æ®</div>
      <div class="nav-item" onclick="navScrollTo('sec-ad-manual')">
        <span class="nav-icon">âœï¸</span>
        <span class="nav-text">å¹¿å‘Šæ•ˆç‡æ‰‹å¡«</span>
        <span class="nav-status empty" id="navAdManual"></span>
      </div>
    </nav>
  </aside>

  <!-- ===== MAIN ===== -->
  <main class="main">

    <!-- MODE SELECTOR -->
    <section id="sec-mode">
      <div class="page-header">
        <h2>åˆ›å»ºæ–°è¯Šæ–­</h2>
        <p>é€‰æ‹©è¯Šæ–­æ¨¡å¼ï¼Œç„¶åæŒ‰éœ€å¡«å†™æ•°æ®ã€‚ç³»ç»Ÿä¼šæ ¹æ®å·²æœ‰æ•°æ®è‡ªåŠ¨åˆ¤æ–­å¯æ‰§è¡Œçš„åˆ†æèŒƒå›´ã€‚</p>
      </div>

      <div class="mode-selector">
        <div class="mode-option selected" onclick="selectMode('a', this)">
          <div class="mode-label">âš¡ æ¨¡å¼A Â· çº¯Sorftimeåˆ†æ</div>
          <div class="mode-desc">ä»…æä¾›ASINå’Œç«å“ï¼Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨Sorftimeæ•°æ®å®Œæˆå¸‚åœºåˆ†æã€‚</div>
          <div class="mode-items">éœ€æä¾›ï¼šASIN + ç«™ç‚¹ + 3ä¸ªç«å“ASIN â†’ è¾“å‡º Step 1-5, 6.1-6.3, 7</div>
        </div>
        <div class="mode-option" onclick="selectMode('b', this)">
          <div class="mode-label">ğŸ”¬ æ¨¡å¼B Â· å…¨é‡è¯Šæ–­</div>
          <div class="mode-desc">æä¾›åå°æŠ¥å‘Šã€æˆªå›¾ã€Rufusé—®ç­”ï¼Œè·å¾—å®Œæ•´8æ­¥è¯Šæ–­æŠ¥å‘Šã€‚</div>
          <div class="mode-items">éœ€æä¾›ï¼šæ¨¡å¼Aå…¨éƒ¨ + 9ä»½åå°æŠ¥å‘Š + å›¾ç‰‡ç´ æ + Rufusæˆªå›¾</div>
        </div>
      </div>
    </section>

    <!-- ===== 1. BASIC INFO ===== -->
    <section class="form-section" id="sec-basic">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--accent-glow); color:var(--accent);">ğŸ“</div>
        <div>
          <div class="form-section-title">äº§å“åŸºç¡€ä¿¡æ¯</div>
          <div class="form-section-subtitle">æ‰€æœ‰åˆ†æçš„èµ·ç‚¹</div>
        </div>
        <span class="form-section-tag tag-required">å¿…å¡«</span>
      </div>

      <div class="field-grid field-grid-2">
        <div class="field">
          <label class="field-label">äº§å“ASIN <span class="required">*</span></label>
          <input type="text" class="field-input mono" placeholder="B0XXXXXXXXX" maxlength="10" id="asinInput">
          <span class="field-hint">ä¸»åŠ›å˜ä½“çš„ASIN</span>
        </div>
        <div class="field">
          <label class="field-label">Amazonç«™ç‚¹ <span class="required">*</span></label>
          <select class="field-input" id="siteSelect" onchange="onSiteChange(this.value)">
            <option value="US" selected>ğŸ‡ºğŸ‡¸ US â€” ç¾å›½ç«™</option>
            <option value="GB">ğŸ‡¬ğŸ‡§ GB â€” è‹±å›½ç«™</option>
            <option value="DE">ğŸ‡©ğŸ‡ª DE â€” å¾·å›½ç«™</option>
            <option value="FR">ğŸ‡«ğŸ‡· FR â€” æ³•å›½ç«™</option>
            <option value="JP">ğŸ‡¯ğŸ‡µ JP â€” æ—¥æœ¬ç«™</option>
            <option value="CA">ğŸ‡¨ğŸ‡¦ CA â€” åŠ æ‹¿å¤§ç«™</option>
            <option value="IT">ğŸ‡®ğŸ‡¹ IT â€” æ„å¤§åˆ©ç«™</option>
            <option value="ES">ğŸ‡ªğŸ‡¸ ES â€” è¥¿ç­ç‰™ç«™</option>
            <option value="MX">ğŸ‡²ğŸ‡½ MX â€” å¢¨è¥¿å“¥ç«™</option>
          </select>
        </div>
      </div>

      <div class="field-grid" style="margin-top:16px;">
        <div class="field-grid field-grid-2">
          <div class="field">
            <label class="field-label">äº§å“åç§°ï¼ˆä¸­æ–‡ç®€ç§°ï¼‰<span class="required">*</span></label>
            <input type="text" class="field-input" placeholder="å¦‚ï¼šäº§å“å‹å· + å“ç±»ä¸­æ–‡å" id="productNameInput">
          </div>
          <div class="field">
            <label class="field-label">å“ç‰Œå <span class="required">*</span></label>
            <input type="text" class="field-input" placeholder="å¦‚ï¼šä½ çš„å“ç‰Œå" id="brandInput">
          </div>
        </div>
      </div>
    </section>

    <!-- ===== 2. COMPETITORS ===== -->
    <section class="form-section" id="sec-competitors">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--red-dim); color:var(--red);">âš”ï¸</div>
        <div>
          <div class="form-section-title">æ ¸å¿ƒç«å“</div>
          <div class="form-section-subtitle">3ä¸ªç›´æ¥ç«å“ï¼ŒæŒ‰å¨èƒåº¦æ’åº</div>
        </div>
        <span class="form-section-tag tag-required">å¿…å¡«</span>
      </div>

      <div class="competitor-card">
        <div class="competitor-header">
          <div class="competitor-num" style="background:var(--red-dim); color:var(--red);">1</div>
          <div>
            <div class="competitor-label">æœ€å¤§å¨èƒç«å“</div>
            <div class="competitor-desc">ä»·æ ¼ç›¸è¿‘ã€æµé‡æœ€å¤§çš„ç›´æ¥ç«äº‰å¯¹æ‰‹</div>
          </div>
        </div>
        <div class="field-grid field-grid-3">
          <div class="field">
            <label class="field-label">ASIN <span class="required">*</span></label>
            <input type="text" class="field-input mono" placeholder="B09XXXXXXX">
          </div>
          <div class="field">
            <label class="field-label">å“ç‰Œ/äº§å“å</label>
            <input type="text" class="field-input" placeholder="å¦‚ï¼šå“ç‰Œå + å‹å·">
          </div>
          <div class="field">
            <label class="field-label">å¨èƒåŸå› </label>
            <input type="text" class="field-input" placeholder="å¦‚ï¼šåŒä»·ä½æµé‡æœ€å¤§">
          </div>
        </div>
        <div class="comp-rufus-inline">
          <div class="comp-rufus-label">ğŸ¤– Rufus é¡µé¢é»˜è®¤é—®é¢˜ <span style="font-weight:400;color:var(--text-muted);">â€” å¤åˆ¶ç«å“é¡µé¢åº•éƒ¨ Ask Rufus æ˜¾ç¤ºçš„3ä¸ªé—®é¢˜åŠå›ç­”</span></div>
          <div class="comp-rufus-qa-row">
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜1ï¼šå¦‚ Can it be used with a smartphone?">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜2ï¼šå¦‚ Does it have a microphone?">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜3ï¼šå¦‚ Is it adjustable?">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="competitor-card">
        <div class="competitor-header">
          <div class="competitor-num" style="background:var(--orange-dim); color:var(--orange);">2</div>
          <div>
            <div class="competitor-label">åŒä»·ä½ç«å“</div>
            <div class="competitor-desc">ä»·æ ¼åŒºé—´é‡å çš„ä¸»è¦å¯¹æ‰‹</div>
          </div>
        </div>
        <div class="field-grid field-grid-3">
          <div class="field">
            <label class="field-label">ASIN <span class="required">*</span></label>
            <input type="text" class="field-input mono" placeholder="B09XXXXXXX">
          </div>
          <div class="field">
            <label class="field-label">å“ç‰Œ/äº§å“å</label>
            <input type="text" class="field-input" placeholder="">
          </div>
          <div class="field">
            <label class="field-label">å¨èƒåŸå› </label>
            <input type="text" class="field-input" placeholder="">
          </div>
        </div>
        <div class="comp-rufus-inline">
          <div class="comp-rufus-label">ğŸ¤– Rufus é¡µé¢é»˜è®¤é—®é¢˜</div>
          <div class="comp-rufus-qa-row">
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜1">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜2">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜3">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="competitor-card">
        <div class="competitor-header">
          <div class="competitor-num" style="background:var(--blue-dim); color:var(--blue);">3</div>
          <div>
            <div class="competitor-label">æ–°å…´å¨èƒç«å“</div>
            <div class="competitor-desc">è¿‘æœŸå¢é•¿è¿…çŒ›ã€æ½œåœ¨å¨èƒ</div>
          </div>
        </div>
        <div class="field-grid field-grid-3">
          <div class="field">
            <label class="field-label">ASIN <span class="required">*</span></label>
            <input type="text" class="field-input mono" placeholder="B09XXXXXXX">
          </div>
          <div class="field">
            <label class="field-label">å“ç‰Œ/äº§å“å</label>
            <input type="text" class="field-input" placeholder="">
          </div>
          <div class="field">
            <label class="field-label">å¨èƒåŸå› </label>
            <input type="text" class="field-input" placeholder="">
          </div>
        </div>
        <div class="comp-rufus-inline">
          <div class="comp-rufus-label">ğŸ¤– Rufus é¡µé¢é»˜è®¤é—®é¢˜</div>
          <div class="comp-rufus-qa-row">
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜1">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜2">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
            <div class="comp-rufus-qa">
              <input type="text" class="field-input" placeholder="é—®é¢˜3">
              <textarea class="field-input" rows="2" placeholder="Rufuså›ç­”..." style="margin-top:4px;"></textarea>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== 3. SUPPLEMENT ===== -->
    <section class="form-section" id="sec-supplement">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--blue-dim); color:var(--blue);">ğŸ“Š</div>
        <div>
          <div class="form-section-title">è¡¥å……è¿è¥æ•°æ®</div>
          <div class="form-section-subtitle">æå‡åˆ†æç²¾åº¦ï¼Œéå¿…å¡«</div>
        </div>
        <span class="form-section-tag tag-recommended">æ¨è</span>
      </div>

      <div class="field-grid field-grid-4">
        <div class="field">
          <label class="field-label">FOBæˆæœ¬ä»· <span class="tip" data-tip="å«åŒ…è£…çš„å‡ºå‚ä»·ï¼ˆå½“åœ°è´§å¸ï¼‰">?</span></label>
          <input type="text" class="field-input mono currency-input" placeholder="$12.50">
        </div>
        <div class="field">
          <label class="field-label">FBAé…é€è´¹/å•</label>
          <input type="text" class="field-input mono currency-input" placeholder="$5.80">
        </div>
        <div class="field">
          <label class="field-label">å½“å‰æœˆé”€é‡</label>
          <input type="text" class="field-input mono" placeholder="5,582">
        </div>
        <div class="field">
          <label class="field-label">æœˆå¹¿å‘ŠèŠ±è´¹</label>
          <input type="text" class="field-input mono currency-input" placeholder="$3,200">
        </div>
      </div>

      <div class="field-grid field-grid-3" style="margin-top:16px;">
        <div class="field">
          <label class="field-label">ç›®æ ‡ACOS (%)</label>
          <input type="text" class="field-input mono" placeholder="25%">
        </div>
        <div class="field">
          <label class="field-label">æ—ºå­£æœˆä»½</label>
          <input type="text" class="field-input" placeholder="å¦‚ 7-8æœˆ, 11-12æœˆ">
        </div>
        <div class="field">
          <label class="field-label">åŒå“ç‰Œå…¶ä»–ASIN</label>
          <input type="text" class="field-input mono" placeholder="B09XX, B0AXX">
        </div>
      </div>

      <div class="field-grid" style="margin-top:16px;">
        <div class="field">
          <label class="field-label">äº§å“æ ¸å¿ƒå–ç‚¹ï¼ˆä½ è®¤ä¸ºçš„ï¼‰</label>
          <textarea class="field-input" rows="2" placeholder="å¦‚ï¼šæ ¸å¿ƒå–ç‚¹1ã€æ ¸å¿ƒå–ç‚¹2ã€æ ¸å¿ƒå–ç‚¹3"></textarea>
        </div>
        <div class="field-grid field-grid-2" style="margin-top:0;">
          <div class="field">
            <label class="field-label">ä¸»è¦å·®è¯„é—®é¢˜ï¼ˆå·²çŸ¥ï¼‰</label>
            <textarea class="field-input" rows="2" placeholder="å¦‚ï¼šå·²çŸ¥çš„å·®è¯„é—®é¢˜"></textarea>
          </div>
          <div class="field">
            <label class="field-label">å½“å‰å¹¿å‘Šç»“æ„ç®€è¿°</label>
            <textarea class="field-input" rows="2" placeholder="å¦‚ï¼šå½“å‰å¹¿å‘Šç»“æ„ç®€è¿°"></textarea>
          </div>
        </div>
        <div class="field">
          <label class="field-label">äº§å“è¿­ä»£è®¡åˆ’</label>
          <input type="text" class="field-input" placeholder="å¦‚ï¼šä¸‹ä¸€ä»£æ”¹ç‰ˆè®¡åˆ’æˆ–æ–°å˜ä½“">
        </div>
      </div>
    </section>

    <div class="divider"></div>

    <!-- ===== MODE B: AD REPORTS ===== -->
    <section class="form-section mode-b-section" id="sec-ad-reports">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--green-dim); color:var(--green);">ğŸ“ˆ</div>
        <div>
          <div class="form-section-title">å¹¿å‘ŠæŠ¥å‘Šä¸Šä¼ </div>
          <div class="form-section-subtitle">Step 6 å¹¿å‘Šè¯Šæ–­æ ¸å¿ƒæ•°æ® â€” 5ä»½CSV/XLSXæ–‡ä»¶</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="alert-info">
        <span class="alert-info-icon">ğŸ’¡</span>
        <div>ä» Seller Central â†’ å¹¿å‘Š â†’ æŠ¥å‘Šä¸­å¿ƒä¸‹è½½ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«æŠ¥å‘Šç±»å‹ï¼Œæ— éœ€ä¸¥æ ¼å‘½åã€‚ä½†å»ºè®®æŒ‰ <strong>{ASIN}_ç±»å‹_æ—¶é—´æ®µ.csv</strong> æ ¼å¼å‘½åã€‚</div>
      </div>

      <div class="field-grid field-grid-2" style="margin-top:16px;">
        <div class="upload-zone" onclick="this.querySelector('input').click()" id="uploadAdCampaign">
          <input type="file" multiple accept=".csv,.xlsx,.xls">
          <div class="upload-icon">ğŸ“Š</div>
          <div class="upload-title">SP / SB / SD Campaign æŠ¥å‘Š</div>
          <div class="upload-desc">è¿‘7å¤©æ•°æ® Â· 3ä»½æ–‡ä»¶ï¼ˆSPå¿…é¡»ï¼ŒSB/SDæ— åˆ™æ³¨æ˜ï¼‰</div>
          <div class="upload-formats">
            <span class="format-tag">CSV</span>
            <span class="format-tag">XLSX</span>
          </div>
          <div class="file-list" id="adCampaignFiles"></div>
        </div>

        <div class="upload-zone" onclick="this.querySelector('input').click()" id="uploadAdSearch">
          <input type="file" multiple accept=".csv,.xlsx,.xls">
          <div class="upload-icon">ğŸ”</div>
          <div class="upload-title">SPæœç´¢è¯ + å¹¿å‘Šä½æŠ¥å‘Š</div>
          <div class="upload-desc">è¿‘30å¤©æ•°æ® Â· 2ä»½æ–‡ä»¶</div>
          <div class="upload-formats">
            <span class="format-tag">CSV</span>
            <span class="format-tag">XLSX</span>
          </div>
          <div class="file-list" id="adSearchFiles"></div>
        </div>
      </div>
    </section>

    <!-- ===== MODE B: BIZ REPORTS ===== -->
    <section class="form-section mode-b-section" id="sec-biz-reports">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--purple-dim); color:var(--purple);">ğŸ“‹</div>
        <div>
          <div class="form-section-title">ä¸šåŠ¡æŠ¥å‘Š + é€€è´§ + å“ç‰Œåˆ†æ</div>
          <div class="form-section-subtitle">Step 4/8 é€€è´§å½’å›  + R-Scoreè®¡ç®—</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="field-grid field-grid-3" style="margin-top:8px;">
        <div class="upload-zone" onclick="this.querySelector('input').click()" style="padding:20px 16px;">
          <input type="file" accept=".csv,.xlsx,.xls">
          <div class="upload-icon">ğŸ“ˆ</div>
          <div class="upload-title">ä¸šåŠ¡æŠ¥å‘Š</div>
          <div class="upload-desc">Detail Page Â· 7å¤©</div>
          <div class="file-list" id="bizReportFiles"></div>
        </div>
        <div class="upload-zone" onclick="this.querySelector('input').click()" style="padding:20px 16px;">
          <input type="file" accept=".csv,.xlsx,.xls">
          <div class="upload-icon">ğŸ“¦</div>
          <div class="upload-title">FBAé€€è´§æŠ¥å‘Š</div>
          <div class="upload-desc">30å¤©</div>
          <div class="file-list" id="returnFiles"></div>
        </div>
        <div class="upload-zone" onclick="this.querySelector('input').click()" style="padding:20px 16px;">
          <input type="file" multiple accept=".csv,.xlsx,.xls">
          <div class="upload-icon">ğŸ·ï¸</div>
          <div class="upload-title">æœç´¢æŸ¥è¯¢ç»©æ•ˆ + å“ç‰Œåˆ†æ</div>
          <div class="upload-desc">ASINè§†å›¾ Â· Råˆ†æ ¸å¿ƒ</div>
          <div class="file-list" id="brandFiles"></div>
        </div>
      </div>
    </section>

    <!-- ===== MODE B: IMAGES ===== -->
    <section class="form-section mode-b-section" id="sec-images">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--cyan-dim); color:var(--cyan);">ğŸ–¼ï¸</div>
        <div>
          <div class="form-section-title">ä¸»å›¾æˆªå›¾ (7å¼  + è§†é¢‘å°é¢)</div>
          <div class="form-section-subtitle">Step 5.3 é€å›¾COSMOå®¡è®¡ â€” æ¯å¼ å•ç‹¬æˆªå›¾</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="image-upload-grid">
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">ä¸»å›¾ 1 (ç™½åº•)</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 2</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 3</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 4</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 5</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 6</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ“·</span>
          <span class="image-slot-label">å›¾ 7</span>
        </div>
        <div class="image-slot" onclick="this.querySelector('input')?.click()">
          <input type="file" accept="image/*" style="display:none;">
          <span class="image-slot-icon">ğŸ¬</span>
          <span class="image-slot-label">è§†é¢‘å°é¢</span>
        </div>
      </div>
    </section>

    <!-- ===== MODE B: A+ ===== -->
    <section class="form-section mode-b-section" id="sec-aplus">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--purple-dim); color:var(--purple);">âœ¨</div>
        <div>
          <div class="form-section-title">A+å†…å®¹æˆªå›¾</div>
          <div class="form-section-subtitle">Step 5.4 A+å†…å®¹COSMOå®¡è®¡ â€” æ»šåŠ¨æˆªå…¨éƒ¨æ¨¡å—</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="upload-zone" onclick="this.querySelector('input').click()">
        <input type="file" multiple accept="image/*">
        <div class="upload-icon">ğŸ–¼ï¸</div>
        <div class="upload-title">æ‹–æ”¾æˆ–ç‚¹å‡»ä¸Šä¼ A+å†…å®¹æˆªå›¾</div>
        <div class="upload-desc">å¯åˆ†æ®µæˆªå›¾ï¼Œæ”¯æŒå¤šå¼ ä¸Šä¼ ã€‚ç³»ç»ŸæŒ‰ä¸Šä¼ é¡ºåºæ’åˆ—ã€‚</div>
        <div class="upload-formats">
          <span class="format-tag">PNG</span>
          <span class="format-tag">JPG</span>
          <span class="format-tag">WEBP</span>
        </div>
        <div class="file-list" id="aplusFiles"></div>
      </div>
    </section>

    <!-- ===== MODE B: LISTING TEXT ===== -->
    <section class="form-section mode-b-section" id="sec-listing-text">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--accent-glow); color:var(--accent);">ğŸ“„</div>
        <div>
          <div class="form-section-title">Listingæ–‡æœ¬å†…å®¹</div>
          <div class="form-section-subtitle">Step 5.1/5.2/5.5 æ ‡é¢˜ã€Bullet Pointsã€åå°Search Terms</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="text-card" style="margin-bottom:12px;">
        <div class="text-card-header">
          <span style="font-size:14px;">ğŸ“Œ</span>
          <span class="text-card-label">å½“å‰æ ‡é¢˜ (Title)</span>
          <span class="text-card-hint">è‹±æ–‡åŸæ–‡ Â· ä»åå°ç¼–è¾‘Listingå¤åˆ¶</span>
        </div>
        <textarea placeholder="ç²˜è´´å½“å‰Listingæ ‡é¢˜è‹±æ–‡åŸæ–‡..."></textarea>
      </div>

      <div class="text-card" style="margin-bottom:12px;">
        <div class="text-card-header">
          <span style="font-size:14px;">ğŸ“‹</span>
          <span class="text-card-label">äº”ç‚¹æè¿° (Bullet Points)</span>
          <span class="text-card-hint">5æ¡Bullet Â· è‹±æ–‡åŸæ–‡ Â· æ¯æ¡ä¸€è¡Œ</span>
        </div>
        <textarea rows="8" placeholder="â€¢ Bullet 1: ...&#10;â€¢ Bullet 2: ...&#10;â€¢ Bullet 3: ...&#10;â€¢ Bullet 4: ...&#10;â€¢ Bullet 5: ..."></textarea>
      </div>

      <div class="text-card">
        <div class="text-card-header">
          <span style="font-size:14px;">ğŸ”‘</span>
          <span class="text-card-label">åå° Search Terms</span>
          <span class="text-card-hint">ä»åå°ç¼–è¾‘Listing â†’ Search Termsæ‰€æœ‰è¡Œå¤åˆ¶</span>
        </div>
        <textarea rows="4" placeholder="ç²˜è´´åå°Search Termsæ‰€æœ‰è¡Œ..."></textarea>
      </div>
    </section>

    <!-- ===== MODE B: RUFUS ===== -->
    <section class="form-section mode-b-section" id="sec-rufus">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--cyan-dim); color:var(--cyan);">ğŸ¤–</div>
        <div>
          <div class="form-section-title">Rufusé—®ç­”è®°å½• â€” è‡ªèº«äº§å“</div>
          <div class="form-section-subtitle">20ä¸ªCOSMOç»´åº¦é—®é¢˜ â€” å¤åˆ¶é—®é¢˜é—®Rufusï¼Œç²˜è´´å›ç­”</div>
        </div>
        <span class="form-section-tag tag-mode-b">æ¨¡å¼B</span>
      </div>

      <div class="alert-info">
        <span class="alert-info-icon">ğŸ’¡</span>
        <div><strong>æ“ä½œæ–¹æ³•ï¼š</strong>Amazon App/ç½‘é¡µ â†’ è¿›å…¥<strong>è‡ªå·±çš„</strong>äº§å“é¡µ â†’ ç‚¹å‡» Ask Rufus â†’ é€æ¡å¤åˆ¶ä¸‹æ–¹æç¤ºè¯å‘é€ï¼ˆæ ¼å¼ç»Ÿä¸€ä¸º <code style="background:rgba(6,182,212,0.15); padding:1px 6px; border-radius:3px; color:var(--cyan);">Tell me more about this product: {å­—æ®µ}</code>ï¼‰â†’ ç²˜è´´Rufuså›ç­”ã€‚<br><strong>æ­¤æ ¼å¼é€‚ç”¨äºæ‰€æœ‰å“ç±»</strong>ï¼ŒRufusä¼šæ ¹æ®äº§å“é¡µé¢ä¸Šä¸‹æ–‡è‡ªåŠ¨è¯†åˆ«å›ç­”ã€‚æœ€å5é¢˜(16-20)ä½¿ç”¨è‡ªç„¶è¯­è¨€æé—®ã€‚</div>
      </div>

      <!-- Self: 20 questions only -->
      <div class="rufus-panel" id="rp-self"></div>
    </section>

    <style>
      .rufus-tab-btn.active { background:var(--cyan-dim)!important; color:var(--cyan)!important; border-color:rgba(6,182,212,0.3)!important; }
      .rq { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-sm); margin-bottom:10px; overflow:hidden; transition:border-color 0.2s; }
      .rq:hover { border-color:var(--border-hover); }
      .rq-head { display:flex; align-items:center; gap:10px; padding:10px 14px; background:rgba(255,255,255,0.015); border-bottom:1px solid rgba(255,255,255,0.03); flex-wrap:wrap; }
      .rq-num { width:24px; height:24px; border-radius:6px; background:var(--cyan-dim); color:var(--cyan); font-size:11px; font-weight:700; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
      .rq-field { font-size:10px; font-weight:700; padding:2px 8px; border-radius:4px; background:rgba(255,255,255,0.04); color:var(--text-muted); letter-spacing:0.3px; text-transform:uppercase; }
      .rq-q { font-size:13px; color:var(--cyan); font-style:italic; flex:1; min-width:200px; cursor:pointer; }
      .rq-q:hover { color:var(--accent); }
      .rq-copy { background:none; border:none; cursor:pointer; font-size:14px; padding:2px 6px; border-radius:4px; transition:background 0.15s; }
      .rq-copy:hover { background:rgba(255,255,255,0.06); }
      .rq-fix { font-size:10px; color:var(--text-muted); white-space:nowrap; }
      .rq textarea { width:100%; background:transparent; border:none; padding:10px 14px; font-size:13px; color:var(--text); font-family:'DM Sans','Noto Sans SC',sans-serif; outline:none; resize:vertical; min-height:52px; line-height:1.6; }
      .rq textarea::placeholder { color:var(--text-placeholder); }
      .rq textarea:focus { background:rgba(6,182,212,0.03); }
      .rq-section-label { font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.5px; padding:16px 0 8px; border-bottom:1px solid var(--border); margin-bottom:12px; }
      .rufus-progress { margin-top:14px; padding:10px 14px; background:rgba(255,255,255,0.02); border-radius:var(--radius-sm); border:1px solid var(--border); font-size:12px; color:var(--text-muted); }
      .copied-toast { position:fixed; top:20px; right:20px; background:var(--green); color:#000; padding:8px 16px; border-radius:8px; font-size:13px; font-weight:600; z-index:9999; opacity:0; transition:opacity 0.3s; pointer-events:none; }
      .copied-toast.show { opacity:1; }
    </style>
    <div class="copied-toast" id="copiedToast">âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

    <div class="divider"></div>

    <!-- ===== MANUAL AD DATA ===== -->
    <section class="form-section mode-b-section" id="sec-ad-manual">
      <div class="form-section-header">
        <div class="form-section-icon" style="background:var(--orange-dim); color:var(--orange);">âœï¸</div>
        <div>
          <div class="form-section-title">å¹¿å‘Šæ•ˆç‡æ‰‹å¡«ï¼ˆå¤‡é€‰ï¼‰</div>
          <div class="form-section-subtitle">æ— æ³•å¯¼å‡ºæŠ¥å‘Šæ—¶ï¼Œæ‰‹å·¥å¡«å†™æ ¸å¿ƒæ•°æ®</div>
        </div>
        <span class="form-section-tag tag-recommended">å¯é€‰</span>
      </div>

      <div class="alert-info">
        <span class="alert-info-icon">â„¹ï¸</span>
        <div>å¦‚æœå·²ä¸Šä¼ å¹¿å‘ŠCSVæŠ¥å‘Šï¼Œæ­¤è¡¨å¯è·³è¿‡ã€‚æ­¤è¡¨ç”¨äºæ— æ³•å¯¼å‡ºæŠ¥å‘Šæ—¶çš„å¤‡é€‰æ–¹æ¡ˆã€‚</div>
      </div>

      <div style="overflow-x:auto;">
      <table class="inline-table">
        <thead>
          <tr><th>æ¸ é“</th><th class="currency-header">èŠ±è´¹ ($)</th><th class="currency-header">é”€å”®é¢ ($)</th><th>ACOS (%)</th><th>è®¢å•æ•°</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-label">SPï¼ˆå•†å“æ¨å¹¿ï¼‰</td>
            <td><input type="text" placeholder="1,200"></td>
            <td><input type="text" placeholder="4,800"></td>
            <td><input type="text" placeholder="25.0"></td>
            <td><input type="text" placeholder="168"></td>
          </tr>
          <tr>
            <td class="row-label">SBï¼ˆå“ç‰Œæ¨å¹¿ï¼‰</td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
          </tr>
          <tr>
            <td class="row-label">SDï¼ˆå±•ç¤ºæ¨å¹¿ï¼‰</td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
            <td><input type="text" placeholder="â€”"></td>
          </tr>
        </tbody>
      </table>
      </div>

      <div class="field-grid field-grid-4" style="margin-top:20px;">
        <div class="field">
          <label class="field-label">7å¤©æ€»é”€å”®é¢</label>
          <input type="text" class="field-input mono currency-input" placeholder="$8,400">
        </div>
        <div class="field">
          <label class="field-label">7å¤©Sessions</label>
          <input type="text" class="field-input mono" placeholder="18,432">
        </div>
        <div class="field">
          <label class="field-label">7å¤©CVR (%)</label>
          <input type="text" class="field-input mono" placeholder="7.03">
        </div>
        <div class="field">
          <label class="field-label">30å¤©é€€è´§ç‡ (%)</label>
          <input type="text" class="field-input mono" placeholder="8.7">
        </div>
      </div>

      <div class="field-grid field-grid-3" style="margin-top:12px;">
        <div class="field">
          <label class="field-label">ç›®æ ‡ACOS (%)</label>
          <input type="text" class="field-input mono" placeholder="25">
        </div>
        <div class="field">
          <label class="field-label">FBAå¯å”®åº“å­˜ï¼ˆä»¶ï¼‰</label>
          <input type="text" class="field-input mono" placeholder="2,400">
        </div>
        <div class="field">
          <label class="field-label">åº“å­˜å¯å”®å¤©æ•°</label>
          <input type="text" class="field-input mono" placeholder="45">
        </div>
      </div>
    </section>

    <!-- ===== SUBMIT BAR ===== -->
    <div class="actions-bar">
      <button class="btn btn-secondary">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
      <div class="actions-spacer"></div>
      <span class="save-hint" id="submitHint">âœ… æ¨¡å¼Aå°±ç»ª â€” å¯å¯åŠ¨Sorftimeåˆ†æ</span>
      <button class="btn btn-primary" id="submitBtn" onclick="handleSubmit()">
        ğŸš€ å¯åŠ¨è¯Šæ–­
      </button>
    </div>

  </main>
</div>

<script>
// Mode selection
let currentMode = 'a';

// Currency mapping per site
const SITE_CURRENCY = {
  US: { symbol: '$', name: 'USD', example: { fob: '$12.50', fba: '$5.80', adSpend: '$3,200', sales7d: '$8,400' }},
  GB: { symbol: 'Â£', name: 'GBP', example: { fob: 'Â£10.00', fba: 'Â£4.50', adSpend: 'Â£2,500', sales7d: 'Â£6,800' }},
  DE: { symbol: 'â‚¬', name: 'EUR', example: { fob: 'â‚¬11.00', fba: 'â‚¬5.20', adSpend: 'â‚¬2,800', sales7d: 'â‚¬7,200' }},
  FR: { symbol: 'â‚¬', name: 'EUR', example: { fob: 'â‚¬11.00', fba: 'â‚¬5.20', adSpend: 'â‚¬2,800', sales7d: 'â‚¬7,200' }},
  IT: { symbol: 'â‚¬', name: 'EUR', example: { fob: 'â‚¬11.00', fba: 'â‚¬5.20', adSpend: 'â‚¬2,800', sales7d: 'â‚¬7,200' }},
  ES: { symbol: 'â‚¬', name: 'EUR', example: { fob: 'â‚¬11.00', fba: 'â‚¬5.20', adSpend: 'â‚¬2,800', sales7d: 'â‚¬7,200' }},
  JP: { symbol: 'Â¥', name: 'JPY', example: { fob: 'Â¥1,800', fba: 'Â¥850', adSpend: 'Â¥480,000', sales7d: 'Â¥1,260,000' }},
  CA: { symbol: 'C$', name: 'CAD', example: { fob: 'C$16.50', fba: 'C$7.80', adSpend: 'C$4,300', sales7d: 'C$11,200' }},
  MX: { symbol: 'MX$', name: 'MXN', example: { fob: 'MX$220', fba: 'MX$105', adSpend: 'MX$58,000', sales7d: 'MX$152,000' }},
};

function onSiteChange(site) {
  const c = SITE_CURRENCY[site] || SITE_CURRENCY.US;
  
  // Update currency-input placeholders
  const inputs = document.querySelectorAll('.currency-input');
  const fields = ['fob', 'fba', 'adSpend', 'sales7d'];
  inputs.forEach((inp, i) => {
    if (fields[i] && c.example[fields[i]]) {
      inp.placeholder = c.example[fields[i]];
    }
  });
  
  // Update table headers
  document.querySelectorAll('.currency-header').forEach(th => {
    th.textContent = th.textContent.replace(/\(.*?\)/, `(${c.symbol})`);
  });
  
  // Show currency badge
  let badge = document.getElementById('currencyBadge');
  if (!badge) {
    badge = document.createElement('div');
    badge.id = 'currencyBadge';
    badge.style.cssText = 'margin-top:8px; font-size:11px; color:var(--accent); font-weight:600;';
    document.getElementById('siteSelect').parentElement.appendChild(badge);
  }
  badge.textContent = `ğŸ’± è´§å¸å•ä½ï¼š${c.symbol} (${c.name})`;
}

function selectMode(mode, el) {
  currentMode = mode;
  document.querySelectorAll('.mode-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  
  const modeBSections = document.querySelectorAll('.mode-b-section');
  modeBSections.forEach(s => {
    if (mode === 'b') {
      s.classList.remove('hidden');
    } else {
      s.classList.add('hidden');
    }
  });
  
  updateProgress();
}

// Initialize mode A (hide mode B sections)
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.mode-b-section').forEach(s => s.classList.add('hidden'));
  setupFileUploads();
  setupImageSlots();
  // Init Rufus panels - only self product
  buildRufusQA(document.getElementById('rp-self'), RUFUS_SELF_QS, 'self', false);
  
  // Global input listener for real-time progress
  document.addEventListener('input', () => updateProgress());
  document.addEventListener('change', () => updateProgress());
  
  // Initial progress calc
  updateProgress();
});

// File upload handlers
function setupFileUploads() {
  document.querySelectorAll('.upload-zone').forEach(zone => {
    const input = zone.querySelector('input[type="file"]');
    if (!input) return;
    
    // Drag & drop
    zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('dragover'); });
    zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
    zone.addEventListener('drop', (e) => {
      e.preventDefault();
      zone.classList.remove('dragover');
      input.files = e.dataTransfer.files;
      handleFileChange(zone, input);
    });
    
    input.addEventListener('change', () => handleFileChange(zone, input));
  });
}

function handleFileChange(zone, input) {
  const fileList = zone.querySelector('.file-list');
  if (!fileList) return;
  
  zone.classList.toggle('has-files', input.files.length > 0);
  fileList.innerHTML = '';
  
  Array.from(input.files).forEach((file, i) => {
    const ext = file.name.split('.').pop().toLowerCase();
    const icon = { csv: 'ğŸ“Š', xlsx: 'ğŸ“Š', xls: 'ğŸ“Š', png: 'ğŸ–¼ï¸', jpg: 'ğŸ–¼ï¸', jpeg: 'ğŸ–¼ï¸', webp: 'ğŸ–¼ï¸' }[ext] || 'ğŸ“„';
    const size = file.size < 1024*1024 
      ? (file.size/1024).toFixed(0) + ' KB'
      : (file.size/1024/1024).toFixed(1) + ' MB';
    
    const item = document.createElement('div');
    item.className = 'file-item';
    item.innerHTML = `
      <span class="file-item-icon">${icon}</span>
      <span class="file-item-name">${file.name}</span>
      <span class="file-item-size">${size}</span>
      <button class="file-item-remove" onclick="event.stopPropagation();">âœ•</button>
    `;
    fileList.appendChild(item);
  });
  
  updateProgress();
}

// Image slot handlers
function setupImageSlots() {
  document.querySelectorAll('.image-slot').forEach(slot => {
    const input = slot.querySelector('input[type="file"]');
    if (!input) return;
    
    input.addEventListener('change', () => {
      if (input.files.length > 0) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
          slot.classList.add('filled');
          // Replace content with preview
          const existingImg = slot.querySelector('.image-slot-preview');
          if (existingImg) existingImg.remove();
          const existingOverlay = slot.querySelector('.image-slot-overlay');
          if (existingOverlay) existingOverlay.remove();
          
          const img = document.createElement('img');
          img.className = 'image-slot-preview';
          img.src = e.target.result;
          slot.appendChild(img);
          
          const overlay = document.createElement('div');
          overlay.className = 'image-slot-overlay';
          overlay.textContent = 'ç‚¹å‡»æ›¿æ¢';
          slot.appendChild(overlay);
          
          updateProgress();
        };
        reader.readAsDataURL(file);
      }
    });
  });
}

// Progress tracking
function updateProgress() {
  // ===== Section-level tracking =====
  const sections = {};
  
  // 1. Basic info: ASIN + site + name + brand (4 required)
  const basicInputs = document.querySelectorAll('#sec-basic input.field-input, #sec-basic select.field-input');
  let basicFilled = 0, basicTotal = 4;
  basicInputs.forEach(inp => { if (inp.value && inp.value.trim()) basicFilled++; });
  sections.basic = { filled: Math.min(basicFilled, basicTotal), total: basicTotal };
  
  // 2. Competitors: 3 ASINs required for Mode A, + Rufus QA for Mode B
  let compFilled = 0, compTotal = 3;
  document.querySelectorAll('.competitor-card').forEach(card => {
    const asinInput = card.querySelector('.field-input.mono');
    if (asinInput?.value?.trim()) compFilled++;
  });
  sections.competitors = { filled: Math.min(compFilled, compTotal), total: compTotal };
  
  // 3. Supplement (optional but tracked)
  const supInputs = document.querySelectorAll('#sec-supplement input.field-input, #sec-supplement textarea.field-input');
  let supFilled = 0;
  supInputs.forEach(inp => { if (inp.value?.trim()) supFilled++; });
  sections.supplement = { filled: supFilled, total: supInputs.length };
  
  // 4. Ad reports (file uploads)
  let adReportFilled = 0;
  document.querySelectorAll('#sec-ad-reports .upload-zone').forEach(zone => {
    if (zone.classList.contains('has-files')) adReportFilled++;
  });
  sections.adReports = { filled: adReportFilled, total: 5 };
  
  // 5. Biz reports
  let bizFilled = 0;
  document.querySelectorAll('#sec-biz-reports .upload-zone').forEach(zone => {
    if (zone.classList.contains('has-files')) bizFilled++;
  });
  sections.bizReports = { filled: bizFilled, total: 4 };
  
  // 6. Images
  let imgFilled = 0;
  document.querySelectorAll('#sec-images .image-slot').forEach(slot => {
    if (slot.querySelector('img')?.src) imgFilled++;
  });
  sections.images = { filled: imgFilled, total: 8 };
  
  // 7. A+ content
  let aplusFilled = 0;
  document.querySelectorAll('#sec-aplus .upload-zone').forEach(zone => {
    if (zone.classList.contains('has-files')) aplusFilled++;
  });
  sections.aplus = { filled: aplusFilled, total: 1 };
  
  // 8. Listing text
  let listFilled = 0;
  document.querySelectorAll('#sec-listing-text textarea').forEach(ta => {
    if (ta.value?.trim()) listFilled++;
  });
  sections.listingText = { filled: listFilled, total: 3 };
  
  // 9. Rufus self (20 answers)
  let rufusFilled = 0;
  document.querySelectorAll('textarea[data-prefix="self"]').forEach(ta => {
    if (ta.value?.trim()) rufusFilled++;
  });
  sections.rufus = { filled: rufusFilled, total: 20 };
  
  // 10. Manual ad data
  let manualFilled = 0;
  document.querySelectorAll('#sec-ad-manual input, #sec-ad-manual select').forEach(inp => {
    if (inp.value?.trim() && inp.value !== 'â€”') manualFilled++;
  });
  sections.adManual = { filled: manualFilled, total: document.querySelectorAll('#sec-ad-manual input, #sec-ad-manual select').length || 1 };
  
  // ===== Update nav status dots =====
  const navMap = {
    navBasic: sections.basic,
    navCompetitors: sections.competitors,
    navSupplement: sections.supplement,
    navAdReports: sections.adReports,
    navBizReports: sections.bizReports,
    navImages: sections.images,
    navAplus: sections.aplus,
    navListingText: sections.listingText,
    navRufus: sections.rufus,
    navAdManual: sections.adManual,
  };
  
  Object.entries(navMap).forEach(([id, s]) => {
    const el = document.getElementById(id);
    if (!el) return;
    el.className = 'nav-status';
    if (s.filled === 0) el.classList.add('empty');
    else if (s.filled >= s.total) el.classList.add('complete');
    else el.classList.add('partial');
  });
  
  // ===== Overall progress =====
  // Mode A requires: basic(4) + competitors(3) = 7
  // Mode B requires: all sections
  let filled, total;
  if (currentMode === 'a') {
    filled = sections.basic.filled + sections.competitors.filled + sections.supplement.filled;
    total = sections.basic.total + sections.competitors.total + sections.supplement.total;
  } else {
    filled = Object.values(sections).reduce((sum, s) => sum + s.filled, 0);
    total = Object.values(sections).reduce((sum, s) => sum + s.total, 0);
  }
  
  const pct = total > 0 ? Math.round((filled / total) * 100) : 0;
  document.getElementById('progressCount').textContent = `${filled} / ${total}`;
  document.getElementById('progressFill').style.width = pct + '%';
  
  // ===== Mode readiness =====
  const modeAReady = sections.basic.filled >= 4 && sections.competitors.filled >= 3;
  const modeBReady = modeAReady && sections.rufus.filled >= 15 && sections.listingText.filled >= 2;
  
  const modeABadge = document.getElementById('modeABadge');
  modeABadge.className = 'mode-badge ' + (modeAReady ? 'ready' : 'not-ready');
  modeABadge.textContent = modeAReady ? 'âœ… æ¨¡å¼A å°±ç»ª' : 'æ¨¡å¼A æœªå°±ç»ª';
  
  const modeBBadge = document.getElementById('modeBBadge');
  modeBBadge.className = 'mode-badge ' + (modeBReady ? 'ready' : 'not-ready');
  modeBBadge.textContent = modeBReady ? 'âœ… æ¨¡å¼B å°±ç»ª' : 'æ¨¡å¼B æœªå°±ç»ª';
  
  // Submit hint
  const hint = document.getElementById('submitHint');
  if (currentMode === 'a') {
    hint.textContent = modeAReady ? 'âœ… æ¨¡å¼Aå°±ç»ª â€” å¯å¯åŠ¨Sorftimeåˆ†æ' : 'âš ï¸ è¯·å®Œæˆå¿…å¡«é¡¹ï¼šASINã€ç«™ç‚¹ã€äº§å“åã€å“ç‰Œã€3ä¸ªç«å“ASIN';
    hint.style.color = modeAReady ? 'var(--green)' : 'var(--orange)';
  } else {
    hint.textContent = modeBReady ? 'âœ… æ¨¡å¼Bå°±ç»ª â€” å¯å¯åŠ¨å…¨é‡è¯Šæ–­' : 'âš ï¸ æ¨¡å¼Béœ€è¡¥å……æ›´å¤šæ•°æ®';
    hint.style.color = modeBReady ? 'var(--green)' : 'var(--orange)';
  }
  
  // Submit button state
  const submitBtn = document.getElementById('submitBtn');
  const ready = currentMode === 'a' ? modeAReady : modeBReady;
  submitBtn.disabled = !ready;
  submitBtn.style.opacity = ready ? '1' : '0.5';
}

function navScrollTo(id) {
  document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  // Update active nav
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const clicked = document.querySelector(`.nav-item[onclick*="${id}"]`);
  if (clicked) clicked.classList.add('active');
}

function handleSubmit() {
  // ===== VALIDATION =====
  document.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
  document.querySelectorAll('.field-error-msg').forEach(el => el.remove());
  
  const errors = [];
  
  const productNameInput = document.getElementById('productNameInput');
  const brandInput = document.getElementById('brandInput');
  if (!productNameInput?.value?.trim()) errors.push({ el: productNameInput, msg: 'è¯·å¡«å†™äº§å“åç§°' });
  if (!brandInput?.value?.trim()) errors.push({ el: brandInput, msg: 'è¯·å¡«å†™å“ç‰Œå' });
  
  const asinInput = document.getElementById('asinInput');
  if (!asinInput?.value?.trim()) {
    errors.push({ el: asinInput, msg: 'è¯·å¡«å†™ASIN' });
  } else if (!/^[A-Z0-9]{10}$/i.test(asinInput.value.trim())) {
    errors.push({ el: asinInput, msg: 'ASINåº”ä¸º10ä½å­—æ¯æ•°å­—' });
  }
  
  const comp1Asin = document.querySelector('#sec-competitors .competitor-card input.mono');
  if (!comp1Asin?.value?.trim()) {
    errors.push({ el: comp1Asin, msg: 'è‡³å°‘å¡«å†™ç«å“1çš„ASIN' });
  }
  
  if (errors.length > 0) {
    errors.forEach(err => {
      if (err.el) {
        err.el.classList.add('field-error');
        const msgEl = document.createElement('span');
        msgEl.className = 'field-error-msg';
        msgEl.textContent = err.msg;
        err.el.parentElement.appendChild(msgEl);
        err.el.addEventListener('input', function handler() {
          this.classList.remove('field-error');
          this.parentElement.querySelector('.field-error-msg')?.remove();
          this.removeEventListener('input', handler);
          updateProgress();
        });
      }
    });
    errors[0].el?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    showToast('è¯·å®Œæˆå¿…å¡«é¡¹: ' + errors.map(e => e.msg).join(', '), 'error');
    return;
  }
  
  // ===== COLLECT TEXT DATA =====
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = 'â³ æäº¤ä¸­...';

  const data = collectFormData();
  
  // ===== COLLECT FILES =====
  const fileGroups = collectFiles();
  const hasFiles = Object.values(fileGroups).some(arr => arr.length > 0);
  
  console.log('ğŸ“¦ COSMO V3 Submit:', { data, fileCount: Object.entries(fileGroups).map(([k,v]) => `${k}:${v.length}`).join(', ') });

  const WEBHOOK_URL = window.COSMO_WEBHOOK_URL || 'https://weizhu.zeabur.app/webhook/cosmo-v3-submit';
  const FILE_WEBHOOK_URL = window.COSMO_FILE_WEBHOOK_URL || 'https://weizhu.zeabur.app/webhook/cosmo-v3-upload';

  // Phase 1: Submit text data
  fetch(WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => {
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  })
  .then(async (result) => {
    const recordId = result.recordId || 'unknown';
    showToast('âœ… æ–‡æœ¬æ•°æ®å·²ä¿å­˜', 'success');
    
    // Phase 2: Upload files if any
    if (hasFiles) {
      btn.innerHTML = 'ğŸ“¤ ä¸Šä¼ æ–‡ä»¶ä¸­...';
      let uploadCount = 0;
      const totalFiles = Object.values(fileGroups).reduce((sum, arr) => sum + arr.length, 0);
      
      for (const [fieldName, files] of Object.entries(fileGroups)) {
        for (const file of files) {
          try {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('recordId', recordId);
            formData.append('fieldName', fieldName);
            formData.append('asin', data.asin);
            
            await fetch(FILE_WEBHOOK_URL, {
              method: 'POST',
              body: formData
            });
            
            uploadCount++;
            btn.innerHTML = `ğŸ“¤ ä¸Šä¼ ä¸­ (${uploadCount}/${totalFiles})...`;
          } catch (err) {
            console.error(`File upload failed: ${file.name}`, err);
          }
        }
      }
      
      showToast(`ğŸ‰ å…¨éƒ¨å®Œæˆï¼${uploadCount}ä¸ªæ–‡ä»¶å·²ä¸Šä¼ `, 'success');
    } else {
      showToast('ğŸ‰ è¯Šæ–­è¯·æ±‚å·²æäº¤', 'success');
    }
    
    btn.innerHTML = 'âœ… å·²æäº¤';
    btn.style.background = 'var(--green)';
    setTimeout(() => {
      btn.disabled = false;
      btn.innerHTML = 'ğŸš€ å¯åŠ¨è¯Šæ–­';
      btn.style.background = '';
    }, 5000);
  })
  .catch(err => {
    btn.disabled = false;
    btn.innerHTML = 'ğŸš€ å¯åŠ¨è¯Šæ–­';
    showToast('æäº¤å¤±è´¥: ' + err.message, 'error');
    console.error('Submit error:', err);
  });
}

// Collect all text form data
function collectFormData() {
  const data = {
    mode: currentMode,
    timestamp: new Date().toISOString(),
    site: document.getElementById('siteSelect')?.value || 'US',
    currency: (SITE_CURRENCY[document.getElementById('siteSelect')?.value] || SITE_CURRENCY.US).name,
    asin: document.getElementById('asinInput')?.value?.trim() || '',
    productName: document.getElementById('productNameInput')?.value?.trim() || '',
    brand: document.getElementById('brandInput')?.value?.trim() || '',
    competitors: [],
    supplement: {},
    rufusSelf: {},
    listing: {},
    manualAd: {},
  };

  // Competitors + inline Rufus
  document.querySelectorAll('.competitor-card').forEach((card, i) => {
    const inputs = card.querySelectorAll('.field-grid .field-input');
    const comp = {
      rank: i + 1,
      asin: inputs[0]?.value?.trim() || '',
      name: inputs[1]?.value?.trim() || '',
      reason: inputs[2]?.value?.trim() || '',
      rufusDefault: []
    };
    card.querySelectorAll('.comp-rufus-qa').forEach(qa => {
      const qInput = qa.querySelector('input');
      const aInput = qa.querySelector('textarea');
      if (qInput?.value?.trim() || aInput?.value?.trim()) {
        comp.rufusDefault.push({
          question: qInput?.value?.trim() || '',
          answer: aInput?.value?.trim() || ''
        });
      }
    });
    data.competitors.push(comp);
  });

  // Supplement
  const supSection = document.getElementById('sec-supplement');
  if (supSection) {
    const supInputs = supSection.querySelectorAll('input.field-input, textarea.field-input');
    const supKeys = ['fobCost','fbaFee','monthlySales','monthlyAdSpend','targetAcos','peakMonths','otherAsins','coreSelling','complaints','adStructure','iterationPlan'];
    supInputs.forEach((inp, i) => {
      if (supKeys[i] && inp.value?.trim()) data.supplement[supKeys[i]] = inp.value.trim();
    });
  }

  // Rufus self
  document.querySelectorAll('textarea[data-prefix="self"]').forEach(ta => {
    const qn = ta.getAttribute('data-qn');
    const field = RUFUS_SELF_QS.find(q => q.n == qn);
    if (ta.value.trim()) {
      data.rufusSelf['q' + qn] = {
        field: field?.f || '',
        prompt: field?.q || '',
        answer: ta.value.trim()
      };
    }
  });

  // Listing text
  const listingSection = document.getElementById('sec-listing-text');
  if (listingSection) {
    const textareas = listingSection.querySelectorAll('textarea');
    if (textareas[0]?.value?.trim()) data.listing.title = textareas[0].value.trim();
    if (textareas[1]?.value?.trim()) data.listing.bullets = textareas[1].value.trim();
    if (textareas[2]?.value?.trim()) data.listing.searchTerms = textareas[2].value.trim();
  }

  // Manual ad table
  const adTable = document.querySelector('#sec-ad-manual .inline-table');
  if (adTable) {
    const channels = ['SP', 'SB', 'SD'];
    data.manualAd.channels = [];
    adTable.querySelectorAll('tbody tr').forEach((row, i) => {
      const cells = row.querySelectorAll('input');
      data.manualAd.channels.push({
        channel: channels[i] || '',
        spend: cells[0]?.value?.trim() || '',
        sales: cells[1]?.value?.trim() || '',
        acos: cells[2]?.value?.trim() || '',
        orders: cells[3]?.value?.trim() || ''
      });
    });
    const metricInputs = document.querySelectorAll('#sec-ad-manual .field-grid-4 .field-input');
    data.manualAd.sales7d = metricInputs[0]?.value?.trim() || '';
    data.manualAd.sessions7d = metricInputs[1]?.value?.trim() || '';
    data.manualAd.cvr7d = metricInputs[2]?.value?.trim() || '';
    data.manualAd.returnRate30d = metricInputs[3]?.value?.trim() || '';
    const metricInputs2 = document.querySelectorAll('#sec-ad-manual .field-grid-3 .field-input');
    data.manualAd.targetAcos = metricInputs2[0]?.value?.trim() || '';
    data.manualAd.fbaInventory = metricInputs2[1]?.value?.trim() || '';
    data.manualAd.daysOfInventory = metricInputs2[2]?.value?.trim() || '';
  }

  return data;
}

// Collect all files grouped by target field
function collectFiles() {
  const files = {
    'å¹¿å‘ŠæŠ¥å‘Šæ–‡ä»¶': [],
    'ä¸šåŠ¡æŠ¥å‘Šæ–‡ä»¶': [],
    'ä¸»å›¾æˆªå›¾': [],
    'AåŠ å†…å®¹æˆªå›¾': [],
  };
  
  // Ad reports (2 upload zones)
  const adZones = document.querySelectorAll('#sec-ad-reports .upload-zone input[type="file"]');
  adZones.forEach(input => {
    Array.from(input.files || []).forEach(f => files['å¹¿å‘ŠæŠ¥å‘Šæ–‡ä»¶'].push(f));
  });
  
  // Biz reports (3 upload zones)
  const bizZones = document.querySelectorAll('#sec-biz-reports .upload-zone input[type="file"]');
  bizZones.forEach(input => {
    Array.from(input.files || []).forEach(f => files['ä¸šåŠ¡æŠ¥å‘Šæ–‡ä»¶'].push(f));
  });
  
  // Product images (8 image slots)
  document.querySelectorAll('#sec-images .image-slot input[type="file"]').forEach(input => {
    Array.from(input.files || []).forEach(f => files['ä¸»å›¾æˆªå›¾'].push(f));
  });
  
  // A+ content
  const aplusInput = document.querySelector('#sec-aplus .upload-zone input[type="file"]');
  if (aplusInput) {
    Array.from(aplusInput.files || []).forEach(f => files['AåŠ å†…å®¹æˆªå›¾'].push(f));
  }
  
  return files;
}

function showToast(msg, type) {
  const existing = document.querySelector('.submit-toast');
  if (existing) existing.remove();
  
  const toast = document.createElement('div');
  toast.className = `submit-toast ${type}`;
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

// ===== RUFUS Q&A SYSTEM =====
const RUFUS_SELF_QS = [
  {n:1, f:'is_a', q:'Tell me more about this product: is_a', fix:'æ ‡é¢˜'},
  {n:2, f:'used_as', q:'Tell me more about this product: used_as', fix:'Bullet / A+'},
  {n:3, f:'used_on', q:'Tell me more about this product: used_on', fix:'Bullet 2 + å›¾5'},
  {n:4, f:'location', q:'Tell me more about this product: location', fix:'A+ åœºæ™¯æ¨¡å—'},
  {n:5, f:'func', q:'Tell me more about this product: func', fix:'æ ‡é¢˜ + Bullet 1'},
  {n:6, f:'capable_of', q:'Tell me more about this product: capable_of', fix:'Bullet 4'},
  {n:7, f:'event', q:'Tell me more about this product: event', fix:'A+ åœºæ™¯æ¨¡å—'},
  {n:8, f:'used_to', q:'Tell me more about this product: used_to', fix:'Bullet 1 + A+'},
  {n:9, f:'used_with', q:'Tell me more about this product: used_with', fix:'A+ æ­é…æ¨¡å—'},
  {n:10, f:'used_by', q:'Tell me more about this product: used_by', fix:'Bullet 3 + å›¾4'},
  {n:11, f:'interest', q:'Tell me more about this product: interest', fix:'A+ ç”¨æˆ·è§è¯'},
  {n:12, f:'xIs_a', q:'Tell me more about this product: xIs_a', fix:'TikTokäººè®¾'},
  {n:13, f:'xWant', q:'Tell me more about this product: xWant', fix:'Bullet 5 + A+'},
  {n:14, f:'audience', q:'Tell me more about this product: audience', fix:'Bullet 5'},
  {n:15, f:'body', q:'Tell me more about this product: body', fix:'Bullet 3 + å›¾4'},
  {n:16, f:'å·®è¯„æš´éœ²', q:'What are the common complaints about this product?', fix:'Bullet 5 æ’é›·', special:'red'},
  {n:17, f:'å–ç‚¹éªŒè¯', q:'What makes this product stand out from competitors?', fix:'æ ‡é¢˜å‰åŠæ®µ', special:'green'},
  {n:18, f:'æ€§ä»·æ¯”', q:'Is this product worth the price?', fix:'A+ å¯¹æ¯”æ¨¡å—', special:'accent'},
  {n:19, f:'ç«å“å¯¹æ¯”', q:'How does this compare to similar products?', fix:'å…¨Listing', special:'purple'},
  {n:20, f:'å…¼å®¹é™åˆ¶', q:'What are the limitations or compatibility issues?', fix:'Bullet 5 + A+', special:'orange'},
];

const RUFUS_COMP_QS = [1,3,5,10,11,13,16,20]; // indices into SELF_QS

function buildRufusQA(container, questions, prefix, isComp) {
  let html = '';
  if (isComp) {
    html += `<div class="alert-info" style="margin-bottom:16px;"><span class="alert-info-icon">âš”ï¸</span><div>ä»…éœ€å›ç­”8ä¸ªå…³é”®é—®é¢˜ã€‚è¿›å…¥ç«å“äº§å“é¡µé¢ï¼Œç”¨åŒæ ·æ–¹å¼é—®Rufusã€‚å°†é—®é¢˜ä¸­çš„ "this" ç†è§£ä¸ºç«å“ã€‚</div></div>`;
  }
  
  const items = isComp 
    ? RUFUS_SELF_QS.filter(q => RUFUS_COMP_QS.includes(q.n))
    : RUFUS_SELF_QS;
  
  let prevSection = '';
  items.forEach((q, i) => {
    // Section divider for self
    if (!isComp && i === 15 && prevSection !== 'extra') {
      html += `<div class="rq-section-label">â–¶ é¢å¤–é«˜ä»·å€¼è¯Šæ–­é—®é¢˜</div>`;
      prevSection = 'extra';
    }
    if (!isComp && i === 0) {
      html += `<div class="rq-section-label">â–¶ COSMO 15ç»´æ ¸å¿ƒé—®é¢˜</div>`;
    }
    
    let fieldStyle = '';
    if (q.special === 'red') fieldStyle = 'background:var(--red-dim);color:var(--red);';
    else if (q.special === 'green') fieldStyle = 'background:var(--green-dim);color:var(--green);';
    else if (q.special === 'accent') fieldStyle = 'background:var(--accent-glow);color:var(--accent);';
    else if (q.special === 'purple') fieldStyle = 'background:var(--purple-dim);color:var(--purple);';
    else if (q.special === 'orange') fieldStyle = 'background:var(--orange-dim);color:var(--orange);';
    
    html += `<div class="rq">
      <div class="rq-head">
        <span class="rq-num">${q.n}</span>
        <span class="rq-field" ${fieldStyle ? `style="${fieldStyle}"` : ''}>${q.f}</span>
        <span class="rq-q" onclick="copyQuestion(this)" title="ç‚¹å‡»å¤åˆ¶é—®é¢˜">"${q.q}"</span>
        <button class="rq-copy" onclick="copyQuestion(this.previousElementSibling)" title="å¤åˆ¶é—®é¢˜">ğŸ“‹</button>
        ${!isComp ? `<span class="rq-fix">â†’ ${q.fix}</span>` : ''}
      </div>
      <textarea class="rufus-qa-answer" data-prefix="${prefix}" data-qn="${q.n}" placeholder="ç²˜è´´Rufusçš„å›ç­”..." oninput="updateRufusProgress('${prefix}')"></textarea>
    </div>`;
  });
  
  const total = items.length;
  html += `<div class="rufus-progress">ğŸ’¡ <strong>å¡«å†™è¿›åº¦ï¼š</strong><span id="rp-${prefix}-count">0</span>/${total} å·²å¡«å†™</div>`;
  
  container.innerHTML = html;
}

function copyQuestion(el) {
  const text = el.textContent.replace(/^"|"$/g, '');
  navigator.clipboard.writeText(text).then(() => {
    const toast = document.getElementById('copiedToast');
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1500);
  });
}

function switchRufusTab(tab, btn) {
  // No longer needed - only self panel exists
}

function updateRufusProgress(prefix) {
  const answers = document.querySelectorAll(`textarea[data-prefix="${prefix}"]`);
  let filled = 0;
  answers.forEach(a => { if (a.value.trim()) filled++; });
  const counter = document.getElementById(`rp-${prefix}-count`);
  if (counter) counter.textContent = filled;
}

// Rufus panels initialized in main DOMContentLoaded above
</script>
</body>
</html>
